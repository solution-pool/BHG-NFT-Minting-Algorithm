class Zonemap{constructor(t){t=parseInt(t);this.VZ=[],this.Z=[],this.vnum=0,this.vsize=RS,this.nz=t,this.total_zones=t*t,this.greatest_zone_size=RS;for(let t=0;t<this.total_zones;t++){let e=[];e.i=t,e.size=RS,e.count=0,e.ZV=[],this.Z[t]=e}}_ac(t,e){this.X=t,this.Y=e}_ad(t){t=parseInt(t);let e=this.vnum;const s=this.X[t],i=this.Y[t],n=this._ai(s,i);this._af(n,e),this.VZ[e]=n;const r=[];return this.vnum>=this.vsize-1&&(this.VZ=r,this.vsize=2*this.vsize),this.vnum+=1,e}_ae(t){return t=parseInt(t),this._ah(this.VZ[t],t),this.VZ[t]=-1,1}_af(t,e){t=parseInt(t),e=parseInt(e);let s=this.Z[t];return null==s&&((s=[]).count=0,s.ZV=[],s.i=0,s.size=SIZE,this.Z.push(s)),s.ZV[s.count]=e,s.count+=1,s.count>=s.size-1?this._ag(s):1}_ag(t){let e=2*t.size;return t.ZV=[],t.size=e,e>this.greatest_zone_size&&(this.greatest_zone_size=e),this.Z.push(t),1}_ah(t,e){t=parseInt(t),e=parseInt(e);let s=this.Z[t];for(let t=0;t<s.count;t++)if(s.ZV[t]==e)return s.ZV[t]=s.ZV[s.count-1],s.count-=1,1;return-1}_ai(t,e){const s=this.nz;return s*parseInt(t*s)+parseInt(e*s)}_aj(t){t=parseInt(t);const e=this.X[t],s=this.Y[t],i=parseInt(this._ai(e,s)),n=parseInt(this.VZ[t]);return n<0?-1:i!=n?(this._ah(n,t),this._af(i,t),this.VZ[t]=i,1):-1}_ak(t,e,s,i){const n=this.nz,r=parseInt(t*n),h=parseInt(e*n);let o=0;const c=s*s;for(let s=Math.max(r-1,0);s<Math.min(r+2,n);s++)for(let r=Math.max(h-1,0);r<Math.min(h+2,n);r++){const h=this.Z[s*n+r];for(let s=0;s<h.count;s++){const n=t-this.X[h.ZV[s]],r=e-this.Y[h.ZV[s]];n*n+r*r<c&&(i[o]=h.ZV[s],o+=1)}}return o}}class Segments{constructor(t,e){this.X=[],_e(this.X,t,0),this.Y=[],_e(this.Y,t,0),this.VA=[],_e(this.VA,t,0),this.VS=[],_e(this.VS,t,-1),this.EV=[],_e(this.EV,2*t,-1),this.VE=[],_e(this.VE,2*t,-1),this.nmax=t,this.vnum=0,this.edgeNumber=0,this.snum=0,this.zonewidth=e,this.nz=1/e,this.nz<3&&(this.nz=1,this.zonewidth=1),this.zonemap=new Zonemap(this.nz),this.zonemap._ac(this.X,this.Y)}_m(t,e){return t<0||t>1||e<0||e>1?-1:1}_n(t,e,s,i){if(this._m(t,e)<0)throw new Error("Vertext outside unit square.");const n=this.vnum;return this.X[n]=t,this.Y[n]=e,this.VA[n]=1,this.VS[n]=s,this.zonemap._ad(n),this.vnum=n+1,n}_o(t,e){return t<0||t>this.vnum-1||this.VA[t]<0?-1:e<0||e>this.vnum-1||this.VA[e]<0?-1:1}_p(t,e){t=parseInt(t),e=parseInt(e);const s=this.edgeNumber;if(this._o(t,e)<0)throw new Error("invalid vertex in _p v1, v2, "+t+","+e);return this.EV[2*s]=t,this.EV[2*s+1]=e,_f(t,s,this.VE),_f(e,s,this.VE),this.edgeNumber+=1,s}_q(t){return this.EV[2*t]>-1&&this.EV[2*t+1]>-1?1:-1}_r(t){return this.VA[t]=-1,this.zonemap._ae(t),1}_s(t){if(t<0||t>this.edgeNumber-1)throw new Error("invalid edge in _s e1"+t);let e=this.EV[2*t],s=this.EV[2*t+1];return this.EV[2*t]=-1,this.EV[2*t+1]=-1,e>-1&&_g(e,t,this.VE),s>-1&&_g(s,t,this.VE),1}_u(t){let e=this.vnum,s=0;for(let i=0;i<e;i++)this.VA[i]>-1&&(t[s][0]=this.X[i],t[s][1]=this.Y[i],s+=1);return s}_v(t){let e=this.X[this.EV[2*t]]-this.X[this.EV[2*t+1]],s=this.Y[this.EV[2*t]]-this.Y[this.EV[2*t+1]];return Math.sqrt(e*e+s*s)}_x(t,e,s,i){let n=[],r=this.snum,h=i.length;for(let o=0;o<h;o++){const h=i[o],c=t+Math.cos(h)*s,a=e+Math.sin(h)*s;n.push(this._n(c,a,r,1))}for(let t=0;t<n.length-1;t++)this._p(n[t],n[t+1]);this._p(n[0],n[h-1]),this.snum=r+1}_y(t,e=-1){if(this._q(t)<0)throw new Error("e1 does not exist");if(t<0)throw new Error("invalid edge in _y e1"+t);let s=this.EV[2*t],i=this.EV[2*t+1],n=this.VS[s];if(n<0)throw new Error("Invalid segment id.");if(e>0){let n=this.X[s]-this.X[i],r=this.Y[s]-this.Y[i];if(n*n+r*r<e*e)throw new Error("edge too short, e1,"+t)}let r=.5*(this.X[s]+this.X[i]),h=.5*(this.Y[s]+this.Y[i]),o=this._n(r,h,n,1);return this._s(t),this._p(s,o),this._p(i,o),1}_aa(t){let e=this.vnum;for(let s=0;s<e;s++){if(this.X[s]<(RS-CS)/2/RS+t||this.X[s]>1-(RS-CS)/2/RS-t)return-1;if(this.Y[s]<(RS-CS)/2/RS+t||this.Y[s]>1-(RS-CS)/2/RS-t)return-1}return 1}_ab(){return this.edgeNumber}}class DifferentialLine extends Segments{constructor(t,e,s,i){super(t,e),this.SX=[],this.SY=[],this.SD=[],this.nearl=s,this.farl=i}_a(t){let e=[];const s=this.vnum;for(let i=0;i<s;i++){this.SX[i]=0,this.SY[i]=0;let s=this.zonemap._ak(this.X[i],this.Y[i],this.farl,e);this._b(i,e,s,t,this.SX,this.SY)}for(let t=0;t<s;t++)this.VA[t]<0||(this.X[t]=this.X[t]+this.SX[t],this.Y[t]=this.Y[t]+this.SY[t]);for(let t=0;t<s;t++)if(!(this.VA[t]<0))try{this.zonemap._aj(t)}catch{}}_b(t,e,s,i,n,r){if(this.VA[t]<1)return-1;let h,o,c=this.VE[2*t],a=this.VE[2*t+1];h=this.EV[2*c]==t?this.EV[2*c+1]:this.EV[2*c],o=this.EV[2*a]==t?this.EV[2*a+1]:this.EV[2*a];let u=0,l=0;for(let n=0;n<s;n++){let s=e[n],r=this.X[t]-this.X[s],c=this.Y[t]-this.Y[s],a=Math.sqrt(r*r+c*c);if(s==h||s==o){if(a<this.nearl||a<=0)continue;u+=-r/a*i,l+=-c/a*i}else{if(a>this.farl||a<=0)continue;u+=r*(this.farl/a-1)*i,l+=c*(this.farl/a-1)*i}}return n[t]+=u,r[t]+=l,1}}function _c(t,e,s){const n=t._ab();let r=[],h=[];for(let t=0;t<n;t++)r.push(Math.random());const o=r.length;for(i=0;i<o;i++)r[i]>s||!r[i]||h.push(i);let c=h.length;for(let s=0;s<c;s++){if(!(t._v(h[s])<e))try{t._y(h[s])}catch(t){continue}}}function _e(t,e,s){for(let i=0;i<e;i++)t[i]=s;return t}function _f(t,e,s){s[2*t]<0?s[2*t]=e:s[2*t+1]=e}function _g(t,e,s){return s[2*t]==e?(s[2*t]=s[2*t+1],s[2*t+1]=-1):s[2*t+1]==e&&(s[2*t+1]=-1),s}function _h(){ctx.fillStyle="rgb("+BACK.toString()+")",ctx.fillRect(0,0,RS,RS)}function _k(t){let e=t.length;for(let s=0;s<e;s++){let e=t[s],i=e[0],n=e[1];ctx.beginPath(),!gf||pe?ctx.strokeStyle="rgb("+BACK.toString()+")":CO<5?ctx.strokeStyle="rgb("+FRONT.toString()+")":ctx.strokeStyle="rgb("+cf.toString()+")",ctx.strokeRect(i*RS,n*RS,ONE*RS,ONE*RS),ctx.stroke()}}let nc,nvc,gf,DF,render,coloroptions,cf;!function(t,e,s,i,n,r,h,o,c){function a(t){var e,s=t.length,n=this,r=0,h=n.i=n.j=0,o=n.S=[];for(s||(t=[s++]);i>r;)o[r]=r++;for(r=0;i>r;r++)o[r]=o[h=V&h+t[r%s]+(e=o[r])],o[h]=e;(n.g=function(t){for(var e,s=0,r=n.i,h=n.j,o=n.S;t--;)e=o[r=V&r+1],s=s*i+o[V&(o[r]=o[h=V&h+e])+(o[h]=e)];return n.i=r,n.j=h,s})(i)}function u(t,e){for(var s,i=t+"",n=0;n<i.length;)e[V&n]=V&(s^=19*e[V&n])+i.charCodeAt(n++);return f(e)}function l(s){try{return p?f(p.randomBytes(i)):(t.crypto.getRandomValues(s=new Uint8Array(i)),f(s))}catch(i){return[+new Date,t,(s=t.navigator)&&s.plugins,t.screen,f(e)]}}function f(t){return String.fromCharCode.apply(0,t)}var p,_=s.pow(i,6),m=s.pow(2,52),S=2*m,V=i-1,g=s["seed"+c]=function(t,n,r){var h=[],o=u(function t(e,s){var i,n=[],r=typeof e;if(s&&"object"==r)for(i in e)try{n.push(t(e[i],s-1))}catch(t){}return n.length?n:"string"==r?e:e+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,f(e)]:null==t?l():t,3),h),p=new a(h);return u(f(p.S),e),(n.pass||r||function(t,e,i){return i?(s[c]=t,e):t})(function(){for(var t=p.g(6),e=_,s=0;m>t;)t=(t+s)*i,e*=i,s=p.g(1);for(;t>=S;)t/=2,e/=2,s>>>=1;return(t+s)/e},o,"global"in n?n.global:this==s)};if(u(s[c](),e),h&&h.exports){h.exports=g;try{p=require("crypto")}catch(t){}}else o&&o.amd&&o(function(){return g})}(this,[],Math,256,0,0,"object"==typeof module&&module,"function"==typeof define&&define,"random");let sl,ai,ctx,sc=1,dp=[],pp=new Array,pn=4,ps=!1,pe=!1,pf=!1,ccs=[],ci=0,co=1,fcs=[],count_pu=0;function preload(){make_color_store()}function make_color_store(){let t=FRONT[0],e=FRONT[1];if(t[0]>e[0])for(let s=t[0];s>=e[0];s--)ccs.push([s,t[1],t[2]]);else for(let s=t[0];s<=e[0];s++)ccs.push([s,t[1],t[2]]);if(t[1]>e[1])for(let s=t[1];s>=e[1];s--)ccs.push([e[0],s,t[2]]);else for(let s=t[1];s<=e[1];s++)ccs.push([e[0],s,t[2]]);if(t[2]>e[2])for(let s=t[2];s>=e[2];s--)ccs.push([e[0],e[1],s]);else for(let s=t[2];s<=e[2];s++)ccs.push([e[0],e[1],s])}function init_current_size(){sc=1,RYTHM>2?(CS=RS,step_unit=parseInt(RS/(RYTHM-1)),sl=parseInt(RS/(RYTHM-1))):sl=step_unit=CS=RS}function setup(){let t=document.getElementById("canvas");t.width=SIZE,t.height=SIZE,ctx=t.getContext("2d"),init_current_size(),gf=!0,ci=0,Math.seedrandom(INDEX+1),cf=FRONT[0],DF=new DifferentialLine(NMAX,2*FARL,NEARL,FARL);let e=[];for(let t=0;t<INIT_NUM;t++)e.push(Math.random()*TWOPI);DF._x(MID,MID,INIT_RAD,e),_h(),draw()}function draw(){ps||(cf=ccs[ci],ci>=ccs.length-1&&(co=2),ci<=0&&(co=1),1==co?ci++:ci--),wrap(render),SIZE<800?setTimeout(function(){ai=requestAnimationFrame(draw)},1e3/(10+parseInt((SIZE-400)/10))):ai=requestAnimationFrame(draw)}function wrap(t){init_coordinates();let e=steps(DF),s=DF._u(nvc),i=nvc.slice(0,s);if(ps)i=pp.shift(),pp.length>=pn*sc?(pe=!0,pf=!1):(pe=!1,pf=!0);else if(gf?dp.push(i):i=dp.pop(),null==i)return void setup();return _k(i),e}function init_coordinates(){nc=[],nvc=[];for(let t=0;t<NMAX;t++)nc[t]=[0,0,0,0];for(let t=0;t<NMAX;t++)nvc[t]=[0,0,0,0]}function steps(t){if(ps)0==pp.length&&(ps=!1,sc<RYTHM-1?sc++:sc=1,sl=step_unit*sc);else if(gf&&!ps&&(t._a(STP),_c(t,NEARL,.5)),check_step(sl,t))if(sc<RYTHM-1){ps=!0;let t=dp.length;for(let e=1;e<=pn*sc;e++)pp.push(dp[t-e]);for(let e=pn*sc;e>0;e--)pp.push(dp[t-e])}else 1==RYTHM&&cancelAnimationFrame(ai),gf&&(cancelAnimationFrame(ai),sleep(1e3*parseInt(RYTHM+1)),SIZE<800?setTimeout(function(){ai=requestAnimationFrame(draw)},1e3/(10+parseInt((SIZE-400)/10))):ai=requestAnimationFrame(draw)),gf=!1}function check_step(t,e){CS=t;let s=e._aa(3*STP)<0;return CS=RS,s}function sleep(t){const e=Date.now();let s=null;do{s=Date.now()}while(s-e<t)}preload(),setup();